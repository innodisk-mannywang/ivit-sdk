# iVIT-SDK Clean Build Test Environment
#
# 用途：驗證 SDK 在乾淨環境下的編譯
#
# 建置映像：
#   docker build -t ivit-build-test -f docker/Dockerfile.build-test .
#
# 執行編譯測試：
#   docker run --rm -v $(pwd):/workspace/ivit-sdk:ro ivit-build-test
#
# 進入互動模式：
#   docker run -it --rm -v $(pwd):/workspace/ivit-sdk:ro ivit-build-test bash

FROM ubuntu:22.04

LABEL maintainer="Innodisk AI Team <ai@innodisk.com>"
LABEL description="iVIT-SDK build verification environment"

ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8

# 基本編譯工具
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    pkg-config \
    git \
    wget \
    # OpenCV
    libopencv-dev \
    # Google Test
    libgtest-dev \
    # Python (for pybind11)
    python3-dev \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# 安裝 pybind11
RUN pip3 install --no-cache-dir pybind11

WORKDIR /workspace

# 預設執行編譯測試腳本
COPY docker/build-test.sh /usr/local/bin/build-test.sh
RUN chmod +x /usr/local/bin/build-test.sh

CMD ["/usr/local/bin/build-test.sh"]
